<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
  import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_AUTH_DOMAIN",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_STORAGE_BUCKET",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // âœ… Prevent infinite redirect loop
  onAuthStateChanged(auth, async (user) => {
    const current = window.location.pathname;

    if (!user) {
      // Redirect only if not already on login page
      if (!current.endsWith('login.html')) {
        window.location.replace('login.html');
      }
      return;
    }

    // ðŸŸ¢ Logged in user - show dashboard data
    try {
      const userDoc = await getDoc(doc(db, "users", user.uid));
      if (userDoc.exists()) {
        const data = userDoc.data();
        document.getElementById("userName").textContent = data.name || "User";
        document.getElementById("roleType").textContent = data.role || "Creator";
      } else {
        document.getElementById("userName").textContent = user.email;
        document.getElementById("roleType").textContent = "Standard User";
      }

      document.getElementById("uploadCount").textContent = "4 Uploaded";
      document.getElementById("viewsCount").textContent = "250 Views";
      document.getElementById("msgCount").textContent = "2 New Messages";
    } catch (err) {
      console.error("Firestore error:", err);
    }
  });

  // ðŸšª Logout
  document.getElementById("logoutBtn").addEventListener("click", () => {
    signOut(auth)
      .then(() => window.location.replace("login.html"))
      .catch((error) => console.error("Logout error:", error));
  });
</script>
