<!-- dashboard.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>MFC â€” Dashboard</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <header class="header">
    <div class="logo">MFC Creator Hub</div>
    <div><button id="logoutBtn" class="btn-ghost">Logout</button></div>
  </header>

  <main>
    <section class="card">
      <div id="userArea">Loading profile...</div>
      <div style="margin-top:12px">
        <a class="btn-primary" href="upload.html">Upload Photo / Video</a>
        <a class="btn-ghost" href="profile.html">My Profile</a>
      </div>
    </section>

    <section class="card" id="myUploads" style="margin-top:16px">
      <h3>My uploads</h3>
      <div id="myUploadsList"></div>
    </section>
  </main>

  <script type="module">
    import { onAuth, logout } from './js/auth.js';
    import { db } from './js/firebase.js';
    import { collection, query, where, orderBy, getDocs } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

    const userArea = document.getElementById('userArea');
    const myUploadsList = document.getElementById('myUploadsList');

    onAuth(async user => {
      if (!user) {
        window.location.href = 'login.html';
        return;
      }
      userArea.innerHTML = `<h2>Welcome, ${user.displayName || user.email}</h2><p>${user.email}</p>`;
      // load my uploads
      const q = query(collection(db,'videos'), where('uid','==', user.uid), orderBy('createdAt','desc'));
      const snap = await getDocs(q);
      myUploadsList.innerHTML = '';
      if (snap.empty) myUploadsList.innerHTML = '<p>No uploads yet.</p>';
      snap.forEach(d => {
        const data = d.data();
        const el = document.createElement('div');
        el.className = 'video-card';
        el.innerHTML = `<a href="watch.html?id=${d.id}"><h4>${data.title}</h4><small>${data.category}</small></a>`;
        myUploadsList.appendChild(el);
      });
    });

    document.getElementById('logoutBtn').addEventListener('click', async () => {
      await logout();
      window.location.href = 'index.html';
    });
  </script>
</body>
</html>
