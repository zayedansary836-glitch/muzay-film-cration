<script type="module">
  import { emailLogin, googleSignIn, registerEmail, forgotPassword, onAuth } from './js/auth.js';
  import { auth } from './js/firebase.js';

  const emailEl = document.getElementById('email');
  const passEl = document.getElementById('password');
  const msg = document.getElementById('msg');

  // ðŸ”¹ Email login
  document.getElementById('loginBtn').addEventListener('click', async () => {
    msg.innerText = '';
    try {
      await emailLogin(emailEl.value.trim(), passEl.value);
      window.location.href = 'dashboard.html';
    } catch (e) {
      msg.innerText = e.message;
    }
  });

  // ðŸ”¹ Google login
  document.getElementById('googleBtn').addEventListener('click', async () => {
    msg.innerText = '';
    try {
      await googleSignIn();
      window.location.href = 'dashboard.html';
    } catch (e) {
      msg.innerText = e.message;
    }
  });

  // ðŸ”¹ Forgot password
  document.getElementById('forgotBtn').addEventListener('click', async () => {
    const email = prompt('Enter your email for password reset:');
    if (!email) return;
    try {
      await forgotPassword(email);
      alert('Reset email sent!');
    } catch (e) {
      alert(e.message);
    }
  });

  // ðŸ”¹ Register new account
  document.getElementById('registerLink').addEventListener('click', async (ev) => {
    ev.preventDefault();
    const email = emailEl.value.trim();
    const pass = passEl.value;
    if (!email || !pass) return alert('Enter email & password');
    try {
      await registerEmail(email, pass);
      alert('Registered successfully!');
      window.location.href = 'dashboard.html';
    } catch (e) {
      alert(e.message);
    }
  });

  // ðŸš« Prevent redirect loop
  onAuth((user) => {
    const path = window.location.pathname;
    if (user && path.endsWith('login.html')) {
      // already logged in, go to dashboard
      window.location.replace('dashboard.html');
    }
  });
</script>
