<script type="module">
  import { emailLogin, googleSignIn, registerEmail, forgotPassword, onAuth } from './js/auth.js';
  import { auth } from './js/firebase.js';

  const emailEl = document.getElementById('email');
  const passEl = document.getElementById('password');
  const msg = document.getElementById('msg');

  // 🔐 Email login
  document.getElementById('loginBtn').addEventListener('click', async () => {
    msg.innerText = '';
    try {
      await emailLogin(emailEl.value.trim(), passEl.value);
      window.location.replace('dashboard.html'); // ✅ safe redirect
    } catch (e) {
      msg.innerText = 'Firebase: ' + (e.message || e.code);
    }
  });

  // 🔑 Google login
  document.getElementById('googleBtn').addEventListener('click', async () => {
    msg.innerText = '';
    try {
      await googleSignIn();
      window.location.replace('dashboard.html'); // ✅ safe redirect
    } catch (e) {
      msg.innerText = 'Google sign-in failed: ' + (e.message || e.code);
    }
  });

  // 🔁 Forgot password
  document.getElementById('forgotBtn').addEventListener('click', async () => {
    const email = prompt('Enter your account email for password reset:');
    if (!email) return;
    try {
      await forgotPassword(email);
      alert('Password reset email sent (check spam).');
    } catch (e) {
      alert('Error: ' + (e.message || e.code));
    }
  });

  // 🧍 Register new user
  document.getElementById('registerLink').addEventListener('click', async (ev) => {
    ev.preventDefault();
    const email = emailEl.value.trim();
    const pass = passEl.value;
    if (!email || !pass) { alert('Enter email and password to register'); return; }
    try {
      await registerEmail(email, pass);
      alert('Registered — welcome!');
      window.location.replace('dashboard.html'); // ✅ direct redirect
    } catch (e) {
      alert('Register error: ' + (e.message || e.code));
    }
  });

  // 🚀 FIX: Redirect only from login page (not upload/profile)
  onAuth(user => {
    const current = window.location.pathname;
    if (user && current.includes('login.html')) {
      window.location.replace('dashboard.html');
    }
  });
</script>
