<!-- index.html - Single-file SPA for MFC (Muzaya Film Creation)
     Features: Firebase Auth (Email + Google), Firestore, Storage, role selection,
               upload media (photo/video), client job posting, simple galleries.
     
     IMPORTANT: Replace firebaseConfig with your real config from Firebase console if different.
-->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MFC Creator Marketplace</title>
  <meta name="description" content="Muzaya Film Creation - Creator marketplace & gallery" />
  <style>
    /* Simple mobile-first orange theme */
    :root{
      --orange:#ff7a00; --orange-2:#f07a00; --bg:#fffaf6;
      --card:#fff; --muted:#6b6b6b; --accent:#ff8f3d;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Poppins", sans-serif;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:linear-gradient(180deg, #fff7f0 0%, #fffaf6 100%);color:#333}
    header.appbar{position:sticky;top:0;background:var(--orange);color:white;padding:14px 16px;display:flex;align-items:center;justify-content:space-between;box-shadow:0 8px 20px rgba(15,15,15,0.06);z-index:10}
    header .brand{display:flex;gap:12px;align-items:center}
    .logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,#ffb37a,#ff7a00);display:flex;align-items:center;justify-content:center;font-weight:700;color:white;font-size:18px}
    header h1{font-size:18px;margin:0}
    header .cta{background:white;color:var(--orange);padding:8px 12px;border-radius:10px;font-weight:700;cursor:pointer}
    main.container{max-width:1100px;margin:18px auto;padding:0 16px}

    /* hero */
    .hero{background:linear-gradient(180deg,#ff9b3a10, transparent);border-radius:14px;padding:18px;margin-bottom:18px;display:flex;gap:14px;align-items:center}
    .hero .left{flex:1}
    .hero h2{margin:0;font-size:24px;color:var(--orange-2)}
    .hero p{margin:8px 0;color:var(--muted)}
    .hero .actions{display:flex;gap:12px;margin-top:8px}

    /* cards grid */
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin-bottom:18px}
    .card{background:var(--card);border-radius:12px;padding:16px;box-shadow:0 6px 18px rgba(15,15,15,0.06)}
    .bigcard{padding:20px}

    /* buttons */
    .btn{display:inline-block;background:var(--orange);color:white;padding:10px 14px;border-radius:10px;text-decoration:none;font-weight:700;border:none;cursor:pointer}
    .btn.ghost{background:transparent;color:var(--orange);border:1px solid rgba(0,0,0,0.06)}
    .btn.secondary{background:#fff;border:1px solid #eee;color:var(--orange)}

    /* small ui */
    label{display:block;margin-bottom:6px;color:var(--muted);font-size:13px}
    input[type="text"], input[type="email"], input[type="password"], textarea, select {
      width:100%;padding:12px;border-radius:8px;border:1px solid #eee;background:#fff;box-shadow:none;
    }
    .muted{color:var(--muted);font-size:13px}
    .row{display:flex;gap:12px;align-items:center}
    .center{text-align:center}
    .hidden{display:none !important}

    /* upload box */
    .upload-box{border:2px dashed #ffd0b0;border-radius:12px;padding:24px;text-align:center;background:#fff6f0}
    .progress{height:10px;background:#ffd4b1;border-radius:99px;overflow:hidden;margin-top:8px}
    .progress > i{display:block;height:100%;background:var(--orange);width:0%}

    /* gallery */
    .thumbs{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:10px}
    .thumb{border-radius:10px;overflow:hidden;height:120px;background:#f7f7f7;display:flex;align-items:center;justify-content:center}
    .thumb img{width:100%;height:100%;object-fit:cover}

    /* small responsive */
    @media(min-width:900px){ .hero h2{font-size:32px} }
    footer{padding:22px;text-align:center;color:var(--muted);font-size:13px;margin-top:30px}
    .error{color:#d33;margin-top:8px}
    .success{color:green;margin-top:8px}
  </style>
</head>
<body>
  <header class="appbar">
    <div class="brand">
      <div class="logo">MFC</div>
      <h1>Muzaya Film Creation</h1>
    </div>
    <div>
      <button id="authBtn" class="cta">Login / Join</button>
    </div>
  </header>

  <main class="container">
    <!-- LANDING / HERO -->
    <section id="homePage">
      <div class="hero card bigcard">
        <div class="left">
          <h2>We craft cinematic wedding films & timeless photos</h2>
          <p>Share your work, get hired, or hire creators — simple, fast, and beautiful.</p>
          <div class="actions">
            <button class="btn" id="startBtn">Create an account</button>
            <button class="btn ghost" id="exploreBtn">Explore Gallery</button>
          </div>
        </div>
        <div style="width:240px;text-align:right">
          <img src="https://images.unsplash.com/photo-1505576391880-7e8d69b9b3a9?auto=format&fit=crop&w=700&q=60" alt="hero" style="width:240px;border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,0.08)">
        </div>
      </div>

      <div class="grid">
        <div class="card">
          <h3>For Creators</h3>
          <p class="muted">Upload portfolio, get clients, sell your skills.</p>
        </div>
        <div class="card">
          <h3>For Clients</h3>
          <p class="muted">Post a job, review proposals, hire the best talent.</p>
        </div>
        <div class="card">
          <h3>Secure Storage</h3>
          <p class="muted">Media uploaded to Firebase Storage with secure URLs.</p>
        </div>
        <div class="card">
          <h3>Messaging (basic)</h3>
          <p class="muted">Clients and creators can chat (simple Firestore messages).</p>
        </div>
      </div>
    </section>

    <!-- AUTH / LOGIN MODAL (in-page) -->
    <section id="authSection" class="hidden">
      <div class="card bigcard">
        <h2 id="authTitle">Login to MFC</h2>
        <div id="authError" class="error hidden"></div>

        <div id="authForms">
          <!-- Simple tabs -->
          <div style="display:flex;gap:8px;margin-bottom:12px">
            <button class="btn secondary" id="showLogin">Login</button>
            <button class="btn secondary" id="showRegister">Register</button>
          </div>

          <!-- LOGIN -->
          <div id="loginForm">
            <label>Email</label>
            <input id="loginEmail" type="email" placeholder="you@example.com" />
            <label>Password</label>
            <input id="loginPassword" type="password" />
            <div style="display:flex;gap:10px;margin-top:10px">
              <button id="doLogin" class="btn">Login</button>
              <button id="googleLogin" class="btn ghost">Sign in with Google</button>
              <button id="forgotBtn" class="btn ghost">Forgot?</button>
            </div>
          </div>

          <!-- REGISTER -->
          <div id="registerForm" class="hidden">
            <label>Name</label>
            <input id="regName" type="text" placeholder="Full name" />
            <label>Email</label>
            <input id="regEmail" type="email" placeholder="you@example.com" />
            <label>Password</label>
            <input id="regPassword" type="password" />
            <div style="margin-top:10px;display:flex;gap:10px;">
              <button id="doRegister" class="btn">Create Account</button>
              <button id="googleRegister" class="btn ghost">Sign in with Google</button>
            </div>
          </div>

          <!-- FORGOT -->
          <div id="forgotForm" class="hidden">
            <label>Enter email to reset password</label>
            <input id="forgotEmail" type="email" />
            <div style="margin-top:8px">
              <button id="doForgot" class="btn">Send Reset Link</button>
              <button id="backToLogin" class="btn ghost">Back</button>
            </div>
            <div id="forgotMsg" class="muted" style="margin-top:8px"></div>
          </div>

        </div>

        <div style="margin-top:14px" class="muted">By creating an account you agree to terms.</div>
        <div style="margin-top:12px"><button id="closeAuth" class="btn ghost">Close</button></div>
      </div>
    </section>

    <!-- ROLE SELECTION -->
    <section id="roleSelect" class="hidden">
      <div class="card bigcard center">
        <h2>Choose Account Type</h2>
        <p class="muted">Are you a client looking to hire, or a creator showcasing work?</p>
        <div style="display:flex;gap:12px;justify-content:center;margin-top:14px">
          <button id="beClient" class="btn">I'm a Client</button>
          <button id="beCreator" class="btn ghost">I'm a Creator</button>
        </div>
      </div>
    </section>

    <!-- DASHBOARD (single view for both roles) -->
    <section id="dashboard" class="hidden">
      <div class="card bigcard">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <h2 id="dashWelcome">Welcome</h2>
            <div id="dashEmail" class="muted"></div>
          </div>
          <div style="display:flex;gap:10px;align-items:center">
            <button id="toProfile" class="btn ghost">Profile</button>
            <button id="logout" class="btn">Logout</button>
          </div>
        </div>

        <hr style="margin:16px 0;border:none;border-top:1px solid #f2f2f2">

        <div id="clientArea" class="hidden">
          <h3>Post a Job</h3>
          <div class="row" style="gap:12px;align-items:stretch">
            <div style="flex:1">
              <label>Title</label>
              <input id="jobTitle" type="text" placeholder="Short title (e.g., wedding highlight edit)">
            </div>
            <div style="width:160px">
              <label>Budget</label>
              <input id="jobBudget" type="text" placeholder="₹">
            </div>
          </div>
          <label>Description</label>
          <textarea id="jobDesc" rows="4" placeholder="Describe deliverables, timeline..."></textarea>
          <div style="margin-top:8px">
            <button id="postJob" class="btn">Post Job</button>
            <div id="jobMsg" class="muted" style="margin-top:8px"></div>
          </div>

          <h3 style="margin-top:18px">Open Jobs</h3>
          <div id="jobsList" class="grid"></div>
        </div>

        <div id="creatorArea" class="hidden">
          <h3>Upload Work</h3>
          <div class="upload-box">
            <div class="muted">Choose a photo or video to upload</div>
            <div style="margin-top:12px">
              <input id="fileInput" type="file" accept="image/*,video/*" />
            </div>
            <div style="margin-top:10px">
              <label>Title</label>
              <input id="uploadTitle" type="text" placeholder="Short title (e.g., bride highlights)">
              <label style="margin-top:8px">Description</label>
              <textarea id="uploadDesc" rows="2" placeholder="Short description"></textarea>
            </div>
            <div style="margin-top:10px">
              <button id="startUpload" class="btn">Upload</button>
              <div class="progress hidden" id="uploadProgress"><i></i></div>
              <div id="uploadMsg" class="muted" style="margin-top:8px"></div>
            </div>
          </div>

          <h3 style="margin-top:18px">My Uploads</h3>
          <div id="myUploads" class="thumbs"></div>
        </div>

      </div>
    </section>

    <!-- PROFILE -->
    <section id="profilePage" class="hidden">
      <div class="card bigcard">
        <h2>Edit Profile</h2>
        <label>Name</label>
        <input id="profileName" type="text" />
        <label>Bio</label>
        <textarea id="profileBio" rows="3"></textarea>
        <label>Display photo URL</label>
        <input id="profilePhoto" type="text" />
        <div style="margin-top:10px">
          <button id="saveProfile" class="btn">Save</button>
          <button id="backDash" class="btn ghost">Back</button>
        </div>
        <div id="profileMsg" class="muted" style="margin-top:8px"></div>
      </div>
    </section>

    <!-- GALLERY modal section -->
    <section id="galleryPage" class="hidden">
      <div class="card bigcard">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h2>Gallery</h2>
          <button id="closeGallery" class="btn ghost">Close</button>
        </div>
        <div id="galleryGrid" class="thumbs" style="margin-top:12px"></div>
      </div>
    </section>

    <footer>© 2025 Muzaya Film Creation — Creator marketplace & gallery</footer>
  </main>

  <!-- Firebase SDKs + App Script -->
  <script type="module">
    // ---- Firebase config (use your project settings) ----
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, sendPasswordResetEmail, signOut, updateProfile } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc, collection, addDoc, query, where, orderBy, onSnapshot, getDocs } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";
    import { getStorage, ref as storageRef, uploadBytesResumable, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-storage.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBH3UcpeD-a-ZEHhghi6bTkGnO9vKeu22c",
      authDomain: "muzaya-film-creation.firebaseapp.com",
      projectId: "muzaya-film-creation",
      storageBucket: "muzaya-film-creation.firebasestorage.app",
      messagingSenderId: "466440504989",
      appId: "1:466440504989:web:ee937abfd4dae2f1ae3674",
      measurementId: "G-02EG3SHXKC"
    };

    // Initialize
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const storage = getStorage(app);

    // ---- UI elements
    const authBtn = document.getElementById('authBtn');
    const startBtn = document.getElementById('startBtn');
    const exploreBtn = document.getElementById('exploreBtn');
    const homePage = document.getElementById('homePage');
    const authSection = document.getElementById('authSection');
    const dashboard = document.getElementById('dashboard');
    const roleSelect = document.getElementById('roleSelect');
    const profilePage = document.getElementById('profilePage');
    const galleryPage = document.getElementById('galleryPage');

    const authError = document.getElementById('authError');
    const authTitle = document.getElementById('authTitle');

    // forms
    const showLogin = document.getElementById('showLogin');
    const showRegister = document.getElementById('showRegister');
    const loginForm = document.getElementById('loginForm');
    const registerForm = document.getElementById('registerForm');
    const forgotForm = document.getElementById('forgotForm');

    // login inputs
    const loginEmail = document.getElementById('loginEmail');
    const loginPassword = document.getElementById('loginPassword');
    const doLogin = document.getElementById('doLogin');
    const googleLogin = document.getElementById('googleLogin');
    const forgotBtn = document.getElementById('forgotBtn');

    // register inputs
    const regName = document.getElementById('regName');
    const regEmail = document.getElementById('regEmail');
    const regPassword = document.getElementById('regPassword');
    const doRegister = document.getElementById('doRegister');
    const googleRegister = document.getElementById('googleRegister');

    // forgot inputs
    const forgotEmail = document.getElementById('forgotEmail');
    const doForgot = document.getElementById('doForgot');
    const backToLogin = document.getElementById('backToLogin');
    const forgotMsg = document.getElementById('forgotMsg');

    // close / open ui
    const closeAuth = document.getElementById('closeAuth');

    // role selection buttons
    const beClient = document.getElementById('beClient');
    const beCreator = document.getElementById('beCreator');

    // dashboard UI
    const dashWelcome = document.getElementById('dashWelcome');
    const dashEmail = document.getElementById('dashEmail');
    const toProfile = document.getElementById('toProfile');
    const logoutBtn = document.getElementById('logout');

    // client area
    const clientArea = document.getElementById('clientArea');
    const jobTitle = document.getElementById('jobTitle');
    const jobBudget = document.getElementById('jobBudget');
    const jobDesc = document.getElementById('jobDesc');
    const postJob = document.getElementById('postJob');
    const jobMsg = document.getElementById('jobMsg');
    const jobsList = document.getElementById('jobsList');

    // creator area
    const creatorArea = document.getElementById('creatorArea');
    const fileInput = document.getElementById('fileInput');
    const uploadTitle = document.getElementById('uploadTitle');
    const uploadDesc = document.getElementById('uploadDesc');
    const startUpload = document.getElementById('startUpload');
    const uploadProgress = document.getElementById('uploadProgress');
    const uploadMsg = document.getElementById('uploadMsg');
    const myUploads = document.getElementById('myUploads');

    // profile
    const profileName = document.getElementById('profileName');
    const profileBio = document.getElementById('profileBio');
    const profilePhoto = document.getElementById('profilePhoto');
    const saveProfile = document.getElementById('saveProfile');
    const backDash = document.getElementById('backDash');
    const profileMsg = document.getElementById('profileMsg');

    // gallery
    const galleryGrid = document.getElementById('galleryGrid');
    const closeGallery = document.getElementById('closeGallery');

    // other
    const authForms = document.getElementById('authForms');
    const authSectionEl = authSection;

    // helper show/hide
    function show(el){ el.classList.remove('hidden') }
    function hide(el){ el.classList.add('hidden') }
    function showOnly(...els){
      const all = [homePage, authSection, roleSelect, dashboard, profilePage, galleryPage];
      all.forEach(a => a.classList.add('hidden'));
      els.forEach(e => e.classList.remove('hidden'));
      window.scrollTo({top:0,behavior:'smooth'});
    }

    // ---------- AUTH UI handlers ----------
    authBtn.addEventListener('click', ()=> showOnly(authSection));
    startBtn.addEventListener('click', ()=> showOnly(authSection));
    exploreBtn.addEventListener('click', ()=> { showOnly(galleryPage); loadGallery(); });

    showLogin.addEventListener('click', ()=>{
      hide(registerForm); hide(forgotForm); show(loginForm); authTitle.textContent="Login to MFC";
    });
    showRegister.addEventListener('click', ()=>{
      hide(loginForm); hide(forgotForm); show(registerForm); authTitle.textContent="Create an account";
    });
    forgotBtn.addEventListener('click', ()=>{
      hide(loginForm); hide(registerForm); show(forgotForm); authTitle.textContent ="Forgot password";
    });
    backToLogin.addEventListener('click', ()=>{ hide(forgotForm); show(loginForm); authTitle.textContent="Login to MFC"; });

    closeAuth.addEventListener('click', ()=> showOnly(homePage));

    // ---------- Firebase Auth functions ----------
    const provider = new GoogleAuthProvider();

    async function signInWithGoogleFlow(){
      try{
        const res = await signInWithPopup(auth, provider);
        const user = res.user;
        // If new user, create profile doc
        await ensureUserDoc(user);
        hide(authError);
        showOnly(roleSelect);
      }catch(err){
        console.error('google signin', err);
        authError.textContent = err.message || 'Google sign-in failed';
        show(authError);
      }
    }

    async function ensureUserDoc(user){
      if(!user) return;
      const uRef = doc(db, 'users', user.uid);
      const snap = await getDoc(uRef);
      if(!snap.exists()){
        // default role: null -> force role selection
        await setDoc(uRef, {
          name: user.displayName || '',
          email: user.email || '',
          photoURL: user.photoURL || '',
          role: null,
          bio: '',
          createdAt: new Date().toISOString()
        });
      }
    }

    googleLogin.addEventListener('click', async ()=> {
      await signInWithGoogleFlow();
    });
    googleRegister.addEventListener('click', async ()=> {
      await signInWithGoogleFlow();
    });

    doRegister.addEventListener('click', async ()=>{
      try{
        const name = regName.value.trim();
        const email = regEmail.value.trim();
        const pass = regPassword.value;
        if(!name || !email || !pass){ authError.textContent='Please fill all fields'; show(authError); return; }
        const cred = await createUserWithEmailAndPassword(auth, email, pass);
        // update profile displayName
        await updateProfile(cred.user, { displayName: name });
        // create user doc
        await setDoc(doc(db, 'users', cred.user.uid), {
          name, email, role: null, bio: '', photoURL: cred.user.photoURL || '', createdAt: new Date().toISOString()
        });
        hide(authError);
        // go to role selection
        showOnly(roleSelect);
      }catch(err){
        console.error('register', err);
        authError.textContent = err.message || 'Registration failed';
        show(authError);
      }
    });

    doLogin.addEventListener('click', async ()=>{
      try{
        const email = loginEmail.value.trim();
        const pass = loginPassword.value;
        if(!email || !pass){ authError.textContent='Please enter email and password'; show(authError); return; }
        await signInWithEmailAndPassword(auth, email, pass);
        hide(authError);
        // onAuthStateChanged will handle redirect to dashboard
      }catch(err){
        console.error('login', err);
        authError.textContent = err.message || 'Login failed';
        show(authError);
      }
    });

    doForgot.addEventListener('click', async ()=>{
      try{
        const email = forgotEmail.value.trim();
        if(!email){ forgotMsg.textContent = 'Enter your email'; return; }
        await sendPasswordResetEmail(auth, email);
        forgotMsg.textContent = 'Reset link sent. Check your email.';
      }catch(err){
        forgotMsg.textContent = 'Error: ' + (err.message || err);
      }
    });

    // ---------- Role selection ----------
    beClient.addEventListener('click', ()=> setRole('client'));
    beCreator.addEventListener('click', ()=> setRole('creator'));

    async function setRole(role){
      const user = auth.currentUser;
      if(!user) { showOnly(authSection); return; }
      await setDoc(doc(db, 'users', user.uid), { role }, { merge:true });
      loadDashboardFor(user.uid);
    }

    // ---------- Auth state ----------
    onAuthStateChanged(auth, async user => {
      if(user){
        // if user doc role missing -> show role selection
        const uSnap = await getDoc(doc(db, 'users', user.uid));
        const data = uSnap.exists() ? uSnap.data() : {};
        if(!data || !data.role){ // no role
          showOnly(roleSelect);
        }else{
          loadDashboardFor(user.uid);
        }
      }else{
        // show landing
        showOnly(homePage);
      }
    });

    // logout
    logoutBtn.addEventListener('click', async ()=>{
      await signOut(auth);
      showOnly(homePage);
    });

    // ---------- DASHBOARD logic ----------
    async function loadDashboardFor(uid){
      const userSnap = await getDoc(doc(db, 'users', uid));
      const user = userSnap.exists() ? userSnap.data() : {};
      dashWelcome.textContent = `Welcome, ${user.name || 'Creator'}`;
      dashEmail.textContent = user.email || auth.currentUser?.email || '';
      // role switch
      if(user.role === 'client'){
        showOnly(dashboard);
        show(clientArea); hide(creatorArea);
        // load open jobs
        loadJobs();
      }else{
        showOnly(dashboard);
        show(creatorArea); hide(clientArea);
        loadMyUploads(uid);
      }
    }

    // ---------- CLIENT: post job ----------
    postJob.addEventListener('click', async ()=>{
      const title = jobTitle.value.trim();
      const desc = jobDesc.value.trim();
      const budget = jobBudget.value.trim();
      if(!title || !desc){ jobMsg.textContent='Please add title and description'; return; }
      try{
        await addDoc(collection(db, 'jobs'), {
          title, desc, budget, createdBy: auth.currentUser.uid, createdAt: new Date().toISOString(), status:'open'
        });
        jobMsg.textContent = 'Job posted';
        jobTitle.value=''; jobDesc.value=''; jobBudget.value='';
        loadJobs();
      }catch(err){
        jobMsg.textContent = 'Error posting job';
      }
    });

    async function loadJobs(){
      jobsList.innerHTML = '';
      try{
        const q = query(collection(db, 'jobs'), orderBy('createdAt','desc'));
        const snap = await getDocs(q);
        if(snap.empty){ jobsList.innerHTML = '<div class="card">No open jobs</div>'; return; }
        snap.forEach(docSnap => {
          const d = docSnap.data();
          const el = document.createElement('div'); el.className='card';
          el.innerHTML = `<h4>${d.title}</h4><p class="muted">${d.desc}</p><div style="display:flex;gap:8px;margin-top:8px">
            <div class="muted">Budget: ${d.budget || '—'}</div>
            <button class="btn ghost" onclick="viewJob('${docSnap.id}')">View</button>
          </div>`;
          jobsList.appendChild(el);
        });
      }catch(err){
        jobsList.innerHTML = '<div class="card">Error loading jobs</div>';
      }
    }

    // small global function for job view
    window.viewJob = function(id){
      alert('Job view placeholder — build separate page for job details. Job ID: '+id);
    };

    // ---------- CREATOR: upload ----------
    startUpload.addEventListener('click', async ()=>{
      const file = fileInput.files[0];
      const title = uploadTitle.value.trim();
      const desc = uploadDesc.value.trim();
      if(!file){ uploadMsg.textContent='Choose a file first'; return; }
      try{
        uploadMsg.textContent = '';
        uploadProgress.classList.remove('hidden');
        const uid = auth.currentUser.uid;
        const timestamp = Date.now();
        const path = `uploads/${uid}/${timestamp}_${file.name}`;
        const sref = storageRef(storage, path);
        const task = uploadBytesResumable(sref, file);
        task.on('state_changed', snapshot => {
          const pct = Math.round((snapshot.bytesTransferred / snapshot.totalBytes) * 100);
          uploadProgress.querySelector('i').style.width = pct + '%';
        }, err => {
          uploadMsg.textContent = 'Upload failed: '+err.message;
        }, async () => {
          const url = await getDownloadURL(task.snapshot.ref);
          // save metadata
          await addDoc(collection(db, 'uploads'), {
            title: title || file.name,
            desc: desc || '',
            url, type: file.type, createdBy: uid,
            createdAt: new Date().toISOString()
          });
          uploadMsg.textContent = 'Upload saved';
          uploadProgress.classList.add('hidden');
          uploadProgress.querySelector('i').style.width = '0%';
          uploadTitle.value=''; uploadDesc.value=''; fileInput.value='';
          loadMyUploads(uid);
        });
      }catch(err){
        uploadMsg.textContent = 'Error: ' + (err.message||err);
      }
    });

    async function loadMyUploads(uid){
      myUploads.innerHTML = '';
      try{
        // simple query
        const snap = await getDocs(query(collection(db, 'uploads'), where('createdBy','==', uid), orderBy('createdAt','desc')));
        if(snap.empty){ myUploads.innerHTML = '<div class="muted">No uploads yet</div>'; return; }
        snap.forEach(s => {
          const d = s.data();
          const div = document.createElement('div'); div.className = 'thumb';
          const isVideo = d.type && d.type.startsWith('video');
          if(isVideo){
            div.innerHTML = `<video src="${d.url}" muted playsinline style="width:100%;height:100%;object-fit:cover"></video>`;
          }else{
            div.innerHTML = `<img src="${d.url}" alt="${d.title||''}">`;
          }
          myUploads.appendChild(div);
        });
      }catch(err){
        myUploads.innerHTML = '<div class="muted">Error loading uploads</div>';
      }
    }

    // ---------- PROFILE ----------
    toProfile.addEventListener('click', async ()=>{
      showOnly(profilePage);
      const uid = auth.currentUser.uid;
      const snap = await getDoc(doc(db, 'users', uid));
      const data = snap.exists() ? snap.data() : {};
      profileName.value = data.name || auth.currentUser.displayName || '';
      profileBio.value = data.bio || '';
      profilePhoto.value = data.photoURL || auth.currentUser.photoURL || '';
    });

    saveProfile.addEventListener('click', async ()=>{
      const name = profileName.value.trim();
      const bio = profileBio.value.trim();
      const photo = profilePhoto.value.trim();
      if(!name){ profileMsg.textContent = 'Name required'; return; }
      try{
        await setDoc(doc(db,'users', auth.currentUser.uid), { name, bio, photoURL: photo }, { merge:true });
        // update Firebase auth profile too
        await updateProfile(auth.currentUser, { displayName: name, photoURL: photo });
        profileMsg.textContent = 'Profile saved';
        setTimeout(()=> profileMsg.textContent='', 2500);
      }catch(err){ profileMsg.textContent = 'Error saving'; }
    });

    backDash.addEventListener('click', ()=> loadDashboardFor(auth.currentUser.uid));

    // ---------- GALLERY ----------
    async function loadGallery(){
      galleryGrid.innerHTML = '';
      try{
        const snap = await getDocs(query(collection(db,'uploads'), orderBy('createdAt','desc')));
        if(snap.empty){ galleryGrid.innerHTML = '<div class="muted">No uploads yet</div>'; return; }
        snap.forEach(snapDoc=>{
          const d = snapDoc.data();
          const el = document.createElement('div'); el.className='thumb';
          el.innerHTML = d.type && d.type.startsWith('video')
            ? `<video src="${d.url}" muted playsinline style="width:100%;height:100%;object-fit:cover"></video>`
            : `<img src="${d.url}" alt="${d.title||''}">`;
          galleryGrid.appendChild(el);
        });
      }catch(err){
        galleryGrid.innerHTML = '<div class="muted">Error loading gallery</div>';
      }
    }

    closeGallery.addEventListener('click', ()=> showOnly(homePage));

    // ---------- Helper: load recent uploads for home (optional) ----------
    async function loadRecentHome(){
      // No UI for now — we keep home simple.
    }

    // On initial load
    showOnly(homePage);

    // ---------- Small notes for developer ----------
    console.log('MFC SPA loaded — Firebase ready.');

    // Expose some functions for debugging in console
    window._mfc = { auth, db, storage, loadJobs, loadMyUploads, loadGallery };
<!-- index.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>MFC — Home</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <header class="header">
    <div class="logo">MFC</div>
    <div>
      <a href="login.html" class="btn-ghost">Login / Join</a>
    </div>
  </header>

  <main>
    <div class="hero-card card">
      <h1>We craft cinematic wedding films & timeless photos</h1>
      <p>Discover creators, browse video portfolios, or get hired — simple and beautiful.</p>
    </div>

    <section class="card" style="margin-top:16px;">
      <h2 style="margin:0 0 12px">Explore</h2>
      <div id="feedContainer"></div>
    </section>
  </main>

  <footer>© Muzaya Film Creation</footer>

  <script type="module">
    import { loadFeed } from './js/feed.js';
    const feed = document.getElementById('feedContainer');
    loadFeed(feed);
  
  </script>

</body>
</html>
